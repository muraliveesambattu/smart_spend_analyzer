<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard | Smart Spend Analyzer</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <style>
      :root {
        --card-border: #e9edf4;
      }
      body {
        background: #f6f8fc;
      }
      .soft-card {
        border: 1px solid var(--card-border);
        border-radius: 16px;
        box-shadow: 0 12px 34px rgba(15, 23, 42, 0.05);
      }
      .amount {
        color: #be123c;
        font-weight: 600;
      }
    </style>
  </head>
  <body>
    <div class="container py-4 py-lg-5">
      <header class="d-flex justify-content-between align-items-end mb-4">
        <div>
          <h1 class="h2 mb-1">Expense Dashboard</h1>
          <p class="text-secondary mb-0">Add and track your daily expenses</p>
        </div>
        <a class="btn btn-sm btn-outline-secondary" href="./index.html">Login</a>
      </header>

      <section class="card soft-card mb-4">
        <div class="card-body">
          <h2 class="h5 mb-3">Add Expense</h2>
          <form id="expenseForm" class="row g-3" novalidate>
            <div class="col-md-3">
              <label for="expenseDate" class="form-label">Date</label>
              <input id="expenseDate" class="form-control" type="date" required />
              <div class="invalid-feedback">Select a date.</div>
            </div>
            <div class="col-md-4">
              <label for="expenseDesc" class="form-label">Description</label>
              <input id="expenseDesc" class="form-control" type="text" placeholder="e.g. Grocery shopping" required />
              <div class="invalid-feedback">Enter a description.</div>
            </div>
            <div class="col-md-3">
              <label for="expenseCategory" class="form-label">Category</label>
              <select id="expenseCategory" class="form-select" required>
                <option value="">Select</option>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Shopping">Shopping</option>
                <option value="Bills">Bills</option>
                <option value="Health">Health</option>
                <option value="Other">Other</option>
              </select>
              <div class="invalid-feedback">Select a category.</div>
            </div>
            <div class="col-md-2">
              <label for="expenseAmount" class="form-label">Amount (INR)</label>
              <input id="expenseAmount" class="form-control" type="number" min="1" step="0.01" required />
              <div class="invalid-feedback">Enter a valid amount.</div>
            </div>
            <div class="col-12 d-flex gap-2">
              <button class="btn btn-primary" type="submit">Add Expense</button>
              <button id="clearAllBtn" class="btn btn-outline-danger" type="button">Clear All</button>
            </div>
          </form>
          <div id="status" class="small mt-3 text-secondary"></div>
        </div>
      </section>

      <section class="row g-4 mb-4">
        <div class="col-md-4">
          <div class="card soft-card h-100">
            <div class="card-body">
              <div class="small text-secondary">Total Expenses</div>
              <div id="totalAmount" class="h4 mb-0 amount">â‚¹0.00</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card soft-card h-100">
            <div class="card-body">
              <div class="small text-secondary">Total Entries</div>
              <div id="totalCount" class="h4 mb-0">0</div>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card soft-card h-100">
            <div class="card-body">
              <div class="small text-secondary">Top Category</div>
              <div id="topCategory" class="h4 mb-0">N/A</div>
            </div>
          </div>
        </div>
      </section>

      <section class="card soft-card">
        <div class="card-body">
          <h2 class="h5 mb-3">Expense List</h2>
          <div id="expenseTableWrap"></div>
        </div>
      </section>
    </div>

    <script>
      const STORAGE_KEY = "smartSpendExpenses";
      const form = document.getElementById("expenseForm");
      const expenseDate = document.getElementById("expenseDate");
      const expenseDesc = document.getElementById("expenseDesc");
      const expenseCategory = document.getElementById("expenseCategory");
      const expenseAmount = document.getElementById("expenseAmount");
      const statusEl = document.getElementById("status");
      const clearAllBtn = document.getElementById("clearAllBtn");
      const totalAmountEl = document.getElementById("totalAmount");
      const totalCountEl = document.getElementById("totalCount");
      const topCategoryEl = document.getElementById("topCategory");
      const expenseTableWrap = document.getElementById("expenseTableWrap");

      let expenses = [];

      function formatINR(value) {
        return new Intl.NumberFormat("en-IN", {
          style: "currency",
          currency: "INR",
          maximumFractionDigits: 2
        }).format(value);
      }

      function setStatus(message, isError = false) {
        statusEl.textContent = message;
        statusEl.className = `small mt-3 ${isError ? "text-danger" : "text-success"}`;
      }

      function saveExpenses() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(expenses));
      }

      function loadExpenses() {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) {
          expenses = [];
          return;
        }
        try {
          const parsed = JSON.parse(raw);
          expenses = Array.isArray(parsed) ? parsed : [];
        } catch (_) {
          expenses = [];
        }
      }

      function calculateTopCategory() {
        if (!expenses.length) return "N/A";
        const totals = {};
        expenses.forEach((item) => {
          totals[item.category] = (totals[item.category] || 0) + item.amount;
        });
        return Object.entries(totals).sort((a, b) => b[1] - a[1])[0][0];
      }

      function renderSummary() {
        const total = expenses.reduce((sum, item) => sum + item.amount, 0);
        totalAmountEl.textContent = formatINR(total);
        totalCountEl.textContent = String(expenses.length);
        topCategoryEl.textContent = calculateTopCategory();
      }

      function deleteExpense(id) {
        expenses = expenses.filter((item) => item.id !== id);
        saveExpenses();
        renderAll();
      }

      function renderTable() {
        if (!expenses.length) {
          expenseTableWrap.innerHTML = '<div class="alert alert-light border mb-0">No expenses added yet.</div>';
          return;
        }

        const rows = [...expenses].sort((a, b) => new Date(b.date) - new Date(a.date));
        expenseTableWrap.innerHTML = `
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead>
                <tr>
                  <th>Date</th>
                  <th>Description</th>
                  <th>Category</th>
                  <th class="text-end">Amount</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>
              <tbody>
                ${rows
                  .map(
                    (item) => `
                  <tr>
                    <td>${new Date(item.date).toLocaleDateString("en-US", { year: "numeric", month: "short", day: "numeric" })}</td>
                    <td>${item.description}</td>
                    <td><span class="badge text-bg-light border">${item.category}</span></td>
                    <td class="text-end amount">${formatINR(item.amount)}</td>
                    <td class="text-end">
                      <button class="btn btn-sm btn-outline-danger delete-btn" data-id="${item.id}" type="button">Delete</button>
                    </td>
                  </tr>
                `
                  )
                  .join("")}
              </tbody>
            </table>
          </div>
        `;

        expenseTableWrap.querySelectorAll(".delete-btn").forEach((button) => {
          button.addEventListener("click", () => {
            deleteExpense(button.dataset.id);
          });
        });
      }

      function renderAll() {
        renderSummary();
        renderTable();
      }

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        form.classList.add("was-validated");

        if (!form.checkValidity()) {
          setStatus("Please fill all required fields.", true);
          return;
        }

        const amount = Number(expenseAmount.value);
        if (!Number.isFinite(amount) || amount <= 0) {
          setStatus("Amount should be greater than zero.", true);
          return;
        }

        expenses.push({
          id: `exp-${Date.now()}-${Math.random().toString(36).slice(2, 8)}`,
          date: expenseDate.value,
          description: expenseDesc.value.trim(),
          category: expenseCategory.value,
          amount
        });

        saveExpenses();
        renderAll();
        form.reset();
        form.classList.remove("was-validated");
        expenseDate.valueAsDate = new Date();
        setStatus("Expense added successfully.");
      });

      clearAllBtn.addEventListener("click", () => {
        expenses = [];
        saveExpenses();
        renderAll();
        setStatus("All expenses cleared.");
      });

      loadExpenses();
      renderAll();
      expenseDate.valueAsDate = new Date();
    </script>
  </body>
</html>
